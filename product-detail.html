<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specs & Details | Nutpa Elite</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body style="padding-top:120px;">
    <nav class="navbar" id="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <img src="assets/logo.png" alt="Nutpa Logo" id="navLogo">
                <div style="font-size: 1.5rem; font-weight: 800; color: var(--text-main);">Nutpa
                    <span>Electronics</span>
                </div>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="products.html">Products</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="nav-actions">
                <a href="contact.html" class="btn btn-primary"
                    style="padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.8rem;">Get a Quote <i
                        data-lucide="arrow-right" style="width: 14px;"></i></a>
                <!-- Actions -->
                <button class="mobile-nav-toggle" id="menuToggle">
                    <i data-lucide="menu"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container section-padding" id="detailContainer">
        <!-- Dynamic Detail -->
    </div>

    <section class="section-padding bg-soft">
        <div class="container">
            <div class="section-header">
                <div>
                    <span class="subtitle">Complete the Setup</span>
                    <h2>Related Hardware</h2>
                </div>
            </div>
            <div class="featured-grid" id="relatedProducts">
                <!-- Related Products -->
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div style="text-align:center;border-top:1px solid var(--border);padding-top:4rem;">
                <p>&copy; 2026 Nutpa Electronics. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/nexus-core.js"></script>
    <script src="js/data.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        initFirebase();
        AOS.init();
        lucide.createIcons();

        // Refresh if cloud data arrives after initial load
        window.addEventListener('cloudSyncReady', () => {
            location.reload();
        });

        // Dynamic Branding
        // Set Logos
        if (settings.siteLogo) {
            const navLogo = document.getElementById('navLogo');
            if (navLogo) navLogo.src = settings.siteLogo;
        }

        try {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const product = products.find(p => p.id == id);
            const container = document.getElementById('detailContainer');

            if (!product) {
                if (container) {
                    container.innerHTML = "<div style='text-align:center;padding:10rem 0;'><h1>Product not found</h1><a href='products.html' class='btn btn-primary'>Back to Products</a></div>";
                }
            } else {
                document.title = `${product.name} | Nutpa`;
                function getMediaHTML(url, type) {
                    if (type === 'image') {
                        return `<img src="${url}" style="width:100%; height:100%; object-fit:contain;" id="currentMainMedia">`;
                    } else {
                        // Check for YouTube
                        if (url.includes('youtube.com') || url.includes('youtu.be')) {
                            let videoId = '';
                            if (url.includes('v=')) {
                                videoId = url.split('v=')[1].split('&')[0];
                            } else {
                                videoId = url.split('/').pop().split('?')[0];
                            }
                            return `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="width:100%; height:100%;"></iframe>`;
                        }
                        return `<video src="${url}" controls autoplay style="width:100%; height:100%; object-fit:contain;" id="currentMainMedia"></video>`;
                    }
                }

                if (container) {
                    container.style.minHeight = "400px";
                    const media = product.media && product.media.length > 0 ? product.media : [{ url: product.image, type: 'image' }];

                    container.innerHTML = `
                        <div class="product-detail-grid">
                            <div class="media-viewer-container">
                                <div id="mainMediaViewer" class="image-card" style="border-radius:20px; overflow:hidden; background:#f8fafc; aspect-ratio: 1/1; display:flex; align-items:center; justify-content:center;">
                                    ${getMediaHTML(media[0].url, media[0].type)}
                                </div>
                                <div class="media-gallery-thumbs" style="display:flex; gap:10px; margin-top:20px; overflow-x:auto; padding-bottom:10px;">
                                    ${media.map((m, i) => `
                                        <div class="thumb-box ${i === 0 ? 'active' : ''}" onclick="switchMainMedia('${m.url}', '${m.type}', this)" style="width:70px; height:70px; border-radius:10px; border:2px solid transparent; overflow:hidden; cursor:pointer; flex-shrink:0; background:#fff;">
                                            ${m.type === 'image'
                            ? `<img src="${m.url}" style="width:100%; height:100%; object-fit:cover;">`
                            : `<div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#000;"><i data-lucide="play" style="color:white; width:20px;"></i></div>`}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div>
                                <span class="subtitle" style="display:block;margin-bottom:1rem;">${product.category || 'Technology'}</span>
                                <h1 style="font-size:3.5rem;margin-bottom:1.5rem;">${product.name}</h1>
                                <div style="font-size:2.5rem;font-weight:800;color:var(--primary);margin-bottom:2rem;">${product.price}</div>
                                <p style="font-size:1.2rem;color:var(--text-soft);line-height:1.7;margin-bottom:3rem;">
                                    ${product.description || 'Premium technical details available upon request.'}
                                </p>
                                
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:3rem;">
                                    ${(product.features || []).map(f => `
                                        <div class="glass" style="padding:1rem;border-radius:15px;display:flex;align-items:center;gap:0.75rem;font-weight:700;font-size:0.9rem;">
                                            <i data-lucide="check-circle" style="width:18px;color:var(--primary);"></i>
                                            <span>${f}</span>
                                        </div>
                                    `).join('')}
                                </div>

                                <div style="display:flex;gap:1rem;">
                                    <button class="btn btn-primary" onclick="requestEnquiry('${product.name}', '${product.price}')">Enquire Now</button>
                                    <button class="btn btn-glass" onclick="window.history.back()">Back</button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Media Switcher Helper
                window.switchMainMedia = function (url, type, thumbEl) {
                    const viewer = document.getElementById('mainMediaViewer');
                    viewer.innerHTML = getMediaHTML(url, type);

                    document.querySelectorAll('.thumb-box').forEach(b => b.style.borderColor = 'transparent');
                    thumbEl.style.borderColor = 'var(--primary)';
                    lucide.createIcons();
                };

                // Related
                const relatedContainer = document.getElementById('relatedProducts');
                if (relatedContainer) {
                    relatedContainer.innerHTML = '';
                    products.filter(p => p.category === product.category && p.id != product.id).slice(0, 4).forEach((p, idx) => {
                        const relImage = p.media && p.media.length > 0 ? p.media[0].url : (p.image || '');
                        relatedContainer.innerHTML += `
                            <div class="p-card-premium glass">
                                <div class="p-img-box">
                                    <img src="${relImage}" alt="${p.altText || p.name}" style="object-fit:contain;">
                                </div>
                                <span class="p-tag" style="text-transform:uppercase;">${p.category}</span>
                                <h3 style="margin: 0.5rem 0;">${p.name}</h3>
                                <p style="font-size: 0.85rem; color: var(--text-soft); margin-bottom: 1rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">${p.description}</p>
                                <div class="p-price-row" style="margin-bottom: 1rem;">
                                    <span class="p-price" style="font-weight: 800; font-size: 1.1rem;">${p.price}</span>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <a href="product-detail.html?id=${p.id}" class="btn btn-primary" style="width: 100%; padding: 0.6rem; border-radius: 6px; font-size: 0.9rem; justify-content: center;">View Specs  â†’</a>
                                    <a href="https://wa.me/919940428882?text=${encodeURIComponent("Hi Nutpa, I'm looking for " + p.name + ". Please share price and availability. My company: [company name], [area in Chennai].")}" class="btn" style="background: #25D366; color: white; width: 100%; padding: 0.6rem; border-radius: 6px; font-size: 0.9rem; justify-content: center; border: none; text-decoration: none;" target="_blank">ðŸ“ž WhatsApp for best price</a>
                                </div>
                            </div>
                        `;
                    });
                }
            }
        } catch (err) {
            console.error("Rendering error:", err);
            document.getElementById('detailContainer').innerHTML = "<div style='color:red;padding:5rem;text-align:center;'>Error loading product details. Please check console.</div>";
        }

        // Force icons regardless
        setTimeout(() => lucide.createIcons(), 100);
        // Enquiry Function
        function requestEnquiry(name, price) {
            // Priority to the requested business number to bypass stale localStorage config
            const num = '919940428882';
            const message = `Hi Nutpa, I'm looking for ${name}. Please share price and availability. My company: [company name], [area in Chennai].`;
            window.open(`https://wa.me/${num}?text=${encodeURIComponent(message)}`, '_blank');
        }

        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) navbar.classList.add('scrolled');
            else navbar.classList.remove('scrolled');
        });

        // WhatsApp Link
        const waLink = document.getElementById('whatsappLink');
        if (waLink) {
            waLink.href = `https://wa.me/919940428882`;
        }
        lucide.createIcons();

        // Mobile Menu Toggle Logic
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.querySelector('.nav-links');

        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                const icon = menuToggle.querySelector('i');
                if (navLinks.classList.contains('active')) {
                    icon.setAttribute('data-lucide', 'x');
                } else {
                    icon.setAttribute('data-lucide', 'menu');
                }
                lucide.createIcons();
            });

            // Close menu when clicking a link
            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.querySelector('i').setAttribute('data-lucide', 'menu');
                    lucide.createIcons();
                });
            });
        }

    </script>
    <a href="https://wa.me/919940428882" class="whatsapp-float" id="whatsappLink" target="_blank">
        <svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.7 17.8 69.4 27.2 106.2 27.2 122.4 0 222-99.6 222-222 0-59.3-23-115.1-65-157.1zM223.9 445.3c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 365.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 54.1 81.2 54.1 130.5 0 101.7-82.8 184.4-184.6 184.4zm101.4-139c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-5.5-2.8-23.2-8.5-44.2-27.1-16.4-14.6-27.4-32.7-30.6-38.1-3.2-5.5-.3-8.5 2.4-11.2 2.5-2.4 5.5-6.5 8.3-9.7 2.8-3.2 3.7-5.5 5.6-9.2 1.9-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 13.2 5.8 23.5 9.2 31.5 11.8 13.3 4.2 25.4 3.6 34.9 2.2 10.6-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" />
        </svg>
    </a>
</body>

</html>